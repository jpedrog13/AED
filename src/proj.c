#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "funcoes.h"

int main(int argc, char **argv){
	
	int i, j=0, end, v, a, v1, v2, m1, m2;
	double c;
	char *p, strf[8], *stri;
	FILE *fin, *fout;
	Graph *G;
	
	if (argc!=2){
		exit(0);
	}
	
	end = strlen(argv[1]);
	
	stri = malloc((end-7)*sizeof(char));
	
	for(i=end-7; i<end; i++){
		strf[j] = argv[1][i];
		j++;
	}
	
	for(i=0; i<end-7; i++){
		stri[i] = argv[1][i];
	}
	
	if(strcmp(strf, ".routes") !=0)
		exit(0);
	
	if((fin = fopen(argv[1], "r"))==NULL)
		exit(0);
	
	if((fout = fopen(strcat(stri, ".bbones"), "w"))==NULL)
		exit(0);
	
	p = malloc(2*sizeof(char)); /*variÃ¡vel p, guarda problema a ser
								analisado*/
	
	while(fscanf(fin, "%d %d %s", &v, &a, p)!=EOF){
		
		if((strcmp(p, "B1") == 0) || (strcmp(p, "C1") == 0)){
			if(fscanf(fin, "%d %d", &v1, &v2)!=2)
				exit(0);
		}
		else if(strcmp(p, "D1") == 0)
			if(fscanf(fin, "%d", &v1)!=1)
				exit(0);
				
/**********************************************************************/
/******************* Aloca memoria e preenche valores *****************/
/**********************************************************************/
		
		G = inicializa(v);
			
		for(i=0; i<a; i++){			
			if(fscanf(fin, "%d %d %lf", &m1, &m2, &c)!=3)
				exit(0);
				
			insereA(G, m1, m2, c);
		}
						

/***************************** FUNCOES ********************************/
		
/**********************************************************************/
/******************************** A1 **********************************/
/**********************************************************************/
		
		if(strcmp(p, "A1")==0){
			
			fprintf(fout, "%d %d %s ", v, a, p);
			
			A1(G, fout);
		}

/**********************************************************************/
/******************************** B1 **********************************/
/**********************************************************************/

		else if(strcmp(p, "B1")==0){
			
			fprintf(fout, "%d %d %s %d %d ", v, a, p, v1, v2);
			
			B1(G, fout, v1, v2);
		}

/**********************************************************************/
/******************************** C1 **********************************/
/**********************************************************************/

		else if(strcmp(p, "C1")==0){
			
			fprintf(fout, "%d %d %s %d %d ", v, a, p, v1, v2);
			
			C1(G, fout, v1, v2);			
		}

/**********************************************************************/
/******************************** D1 **********************************/
/**********************************************************************/

		else if(strcmp(p, "D1")==0){
			
			fprintf(fout, "%d %d %s %d ", v, a, p, v1);
			
			D1(G, fout, v1);
		}

/**********************************************************************/
/******************************** E1 **********************************/
/**********************************************************************/

		else if(strcmp(p, "E1")==0){
			
			fprintf(fout, "%d %d %s ", v, a, p);
			
			E1(G, fout);			
		}

/**********************************************************************/
/************************* Liberta memoria ****************************/
/**********************************************************************/
		liberta(G);
		
	}

	free(stri);
	free(p);
	
	fclose(fin);
	fclose(fout);
	
	exit(0);
}

